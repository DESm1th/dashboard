{% extends "base.html" %}

{% block content %}
  {% include 'flash.html' %}
    <script type=text/javascript>
      // bind the submit event to the form elements
      $(function() {
        $("[name=select_metrics]").find("select").bind('change', function(){
          $(this).closest("form").submit();
        })
      });
      //catch the update button even and use it to update the hidden field to True
      $(function(){
        $("input[type=submit]").bind('click', function(){
          $(this).closest("form").find("input[name=query_complete]").val('True');
        })
      });
    </script>
    <div class="bd-pageheader jumbotron">
        <h1>Sites</h1>
    </div>
    <div class="container">

      <form class="form-inline" action="" method="post" name="select_metrics">
        {{ form.csrf_token }}
        {{ form.query_complete}}
          <div class="form-group">
            <div class="control-label text-primary" for="site_id">Sites</div>
            {{ form.site_id(maxlength=64, class=span4) }}
          </div>
          <div class="form-group">
            <div class="control-label text-primary" for="study_id">Studies</div>
            {{ form.study_id(maxlength=64, class=span4) }}
          </div>
          <div class="form-group">
            <div class="control-label text-primary" for="scantype_id">Scan types</div>
            {{ form.scantype_id(maxlength=64, class=span4) }}
          </div>
          <div class="form-group">
            <div class="control-label text-primary" for="metrictype_id">Metrics</div>
            {{ form.metrictype_id(maxlength=64, class=span4) }}
          </div>

            <div class="controls row">
              <input class="btn btn-primary" type="submit" value="update">
            </div>
          </div>

      </form>
    </div>

    <div id='data' hidden>
          {{data}}
    </div>
    <div id='chart'></div>
    <script>
    var dataFromSelection = document.getElementById('data');
    var dataList = JSON.parse(dataFromSelection.innerHTML);
    var valueList = [];
    var subjectList = [];

    dataList.forEach(function(entry){
      valueList.push(entry.value);
      subjectList.push(entry.session_name)
    });

    valueList.unshift(dataList[0].metrictype);

    var chart = c3.generate({
        bindto: '#chart',
        data: {
            columns: [
              valueList
            ]
        },
        axis: {
          x: {
            type: 'category',
            categories: subjectList
          }
        }
    });</script>

{% endblock %}
